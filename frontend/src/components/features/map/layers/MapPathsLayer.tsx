/**
 * MapPathsLayer
 * SVG ì§€ë„ ë°°ê²½ ë ˆì´ì–´ (êµ­ê°€ ê²½ê³„ì„ )
 * 
 * ì „ëµ:
 * - 14ê°œ íƒ€ê²Ÿ ìœ ëŸ½ êµ­ê°€: ê°œë³„ path ê´€ë¦¬ (Interactive)
 * - ë‚˜ë¨¸ì§€ êµ­ê°€: ê·¸ë£¹í™” (Non-interactive, ë°°ê²½)
 * 
 * ì„±ëŠ¥ ìµœì í™”:
 * - íƒ€ê²Ÿ êµ­ê°€ë§Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¶€ì°©
 * - ë‚˜ë¨¸ì§€ëŠ” pointer-events: none
 */

'use client';

import React, { useCallback } from 'react';
import { useESGMapStore } from '@/store/esgMapStore';
import { COLORS } from '@/constants/esg-map';
import type { CountryCode } from '@/types/esg-map';

/**
 * Props
 */
interface MapPathsLayerProps {
  opacity?: number; // ë°°ê²½ ì§€ë„ íˆ¬ëª…ë„ (ê¸°ë³¸: 0.3)
  showOtherCountries?: boolean; // íƒ€ê²Ÿ ì™¸ êµ­ê°€ í‘œì‹œ ì—¬ë¶€
}

/**
 * íƒ€ê²Ÿ êµ­ê°€ Path ë°ì´í„°
 * world.svgì—ì„œ ì¶”ì¶œí•œ 14ê°œ ìœ ëŸ½ êµ­ê°€
 */
const TARGET_COUNTRY_PATHS: Record<CountryCode, string> = {
  // ğŸ‡¬ğŸ‡§ United Kingdom (class="United Kingdom")
  GB: 'M 956.7 158.2 953.2 157 950.2 157.1 951.4 153.8 950.5 150.6 954.5 150.3 959.4 154.1 956.7 158.2 Z M 972.6 129.5 967.5 136 972.2 135.2 977.3 135.2 976 140.1 971.7 145.5 976.6 145.8 976.9 146.5 981.1 153.6 984.3 154.6 987.2 161.6 988.6 164 994.5 165.1 993.9 169.1 991.5 170.9 993.4 174.1 989 177.3 982.5 177.2 974.1 179 971.9 177.7 968.6 180.6 964.1 179.9 960.5 182.3 958 181.1 965.3 174.6 969.7 173.2 962.1 172.2 960.8 169.7 965.9 167.8 963.4 164.5 964.4 160.5 971.5 161.1 972.3 157.5 969.2 153.8 969.1 153.7 963.4 152.6 962.3 151 964.1 148.3 962.6 146.6 960 149.5 959.9 143.6 957.7 140.6 959.6 134.4 963.4 129.6 967 130 972.6 129.5 Z',
  
  // ğŸ‡©ğŸ‡ª Germany (id="DE")
  DE: 'M1053.9 158.9l1.4 3.1-1.2 1.7 1.9 2.1 1.5 3.3-0.2 2.2 2.4 3.9-2.2 0.6-1.3-0.7-1.1 1.2-3.5 1.2-1.7 1.6-3.4 1.3 1 1.8 0.7 2.7 2.6 1.5 3 2.6-1.6 2.9-1.7 0.8 1 4.1-0.4 1.1-1.7-1.3-2.4-0.2-3.5 1.1-4.4-0.3-0.6 1.7-2.7-1.7-1.4 0.3-5.5-1.9-1 1.3-4.2 0 0.4-4.5 2.4-4.2-7.2-1.2-2.4-1.6 0.2-2.7-1-1.4 0.4-4.2-1.1-6.5 2.9 0 1.2-2.3 0.9-5.6-0.9-2.1 0.8-1.3 4-0.3 1 1.3 3.1-3-1.3-2.3-0.4-3.4 3.7 0.8 2.9-0.9 0.3 2.3 4.9 1.4 0.1 2.2 4.7-1.2 2.6-1.6 5.6 2.4 2.4 1.9z',
  
  // ğŸ‡«ğŸ‡· France (class="France")
  FR: 'M 1035.7 231.4 1034.2 236.3 1031.8 235 1030.5 230.8 1031.4 228.4 1034.6 226 1035.7 231.4 Z M 1014.4 185 1015.5 185.5 1016.9 185.4 1019.3 187 1026.5 188.2 1024.1 192.4 1023.7 196.9 1022.4 198 1020.1 197.4 1020.3 199 1016.7 202.5 1016.7 205.4 1019.1 204.4 1020.9 207.1 1020.8 208.9 1022.3 211.3 1020.6 213.2 1022.1 218.1 1024.9 218.9 1024.4 221.6 1019.9 225.2 1009.7 223.5 1002.3 225.6 1001.7 229.4 995.8 230.2 990 227.3 988.1 228.7 978.6 225.8 976.6 223.4 979.3 219.6 980.3 207 975.2 200.4 971.5 197.2 963.9 194.8 963.5 190.2 970 188.9 978.3 190.5 976.8 183.4 981.5 186.1 992.9 181.3 994.4 176.2 998.6 174.9 999.4 177.1 1001.6 177.2 1004 179.7 1007.5 182.6 1010 182.1 1014.4 185 Z',
  
  // ğŸ‡³ğŸ‡± Netherlands (id="NL")
  NL: 'M1016.5 177.1l-2.8-1.5-3.1-2.7-4.5 1.3-3.6-0.5 2.5-1.7 4-9 6.5-2.6 4 0.2 0.9 2.1-0.9 5.6-1.2 2.3-2.9 0 1.1 6.5z',
  
  // ğŸ‡¸ğŸ‡ª Sweden (id="SE")
  SE: 'M1088.2 87l-7 1.6-3.5 3.9 1.3 3.5-6.2 4.5-7.8 5-2.1 8.1 3.7 4.1 4.8 3.3-3.3 6.6-4.6 1.4-0.6 10-2.1 5.7-5.7-0.6-2.2 4.8-5.5 0.3-1.9-5.7-4.5-6.9-4.2-8.4 1.8-3.4 3.4-4 0.8-6.9-3.1-2.9-1-7.7 2.4-5.4 4.3 0.1 1.3-2.2-1.8-2 5.7-7.9 3.4-6.1 2.3-3.9 4 0 0.6-3.1 8 0.9-0.1-3.6 2.6-0.2 6 2.7 7.2 3.7 1.8 8.5 1.8 2.2z',
  
  // ğŸ‡«ğŸ‡® Finland (id="FI")
  FI: 'M1104.1 70.1l0.4 3.8 7.3 3.7-2.9 4.2 6.5 6.3-1.7 4.8 4.9 4.2-0.9 3.8 7.4 3.9-0.9 2.9-3.4 3.4-8 7.4-8 0.5-7.6 2.1-7.1 1.3-3.2-3.2-4.7-1.9 0.1-5.8-3-5.2 1.6-3.4 3.3-3.5 8.8-6.2 2.6-1.2-0.9-2.4-6.5-2.6-1.8-2.2-1.8-8.5-7.2-3.7-6-2.7 2.2-1.4 5.1 2.8 5.3-0.2 4.7 1.3 3.4-2.4 1.1-4 5.9-1.8 5.8 2.1-0.8 3.8z',
  
  // ğŸ‡³ğŸ‡´ Norway (class="Norway")
  NO: 'M 1113.7 67.5 1107.3 69.6 1104.1 70.1 1104.9 66.3 1099.1 64.2 1093.2 66 1092.1 70 1088.7 72.4 1084 71.1 1078.7 71.3 1073.6 68.5 1071.4 69.9 1068.8 70.1 1068.9 73.7 1060.9 72.8 1060.3 75.9 1056.3 75.9 1054 79.8 1050.6 85.9 1044.9 93.8 1046.7 95.8 1045.4 98 1041.1 97.9 1038.7 103.3 1039.7 111 1042.8 113.9 1042 120.8 1038.6 124.8 1036.8 128.2 1033.5 124.6 1024.9 131.4 1018.8 132.8 1012.3 129.8 1010.5 123.5 1008.5 110 1012.5 106.3 1023.8 101.4 1031.9 95.5 1039.1 87.7 1048 77 1054.4 72.9 1064.7 66.1 1073.2 63.7 1079.9 64 1085.1 59.6 1092.5 59.8 1099.5 58.8 1113.2 62.7 1108.3 64.1 1113.7 67.5 Z M 1076.6 25.2 1069 27.1 1062.2 26 1064.4 24.8 1061.8 23.3 1069.1 22.4 1071 24.1 1076.6 25.2 Z M 1051 16.7 1063.6 20.1 1055 21.9 1053.8 25.3 1050.8 26.2 1049.9 30.2 1045.5 30.4 1037 27.5 1040 25.8 1034.3 24.4 1026.6 20.5 1023.4 17 1032.7 15.4 1035 16.9 1040 16.9 1041 15.4 1046.2 15.2 1051 16.7 Z M 1075.4 13.7 1082.8 15.2 1078.4 17.6 1068.3 18.1 1057.6 17.3 1056.6 16.1 1051.5 16.1 1047.2 14.1 1057.7 12.9 1063.1 13.9 1066.2 12.6 1075.4 13.7 Z',
  
  // ğŸ‡¨ğŸ‡­ Switzerland (id="CH")
  CH: 'M1034.4 197.5l0.2 1.1-0.7 1.5 2.3 1.2 2.6 0.2-0.3 2.5-2.1 1.1-3.8-0.8-1 2.5-2.4 0.2-0.9-1-2.7 2.2-2.5 0.3-2.2-1.4-1.8-2.7-2.4 1 0-2.9 3.6-3.5-0.2-1.6 2.3 0.6 1.3-1.1 4.2 0 1-1.3 5.5 1.9z',
  
  // ğŸ‡§ğŸ‡ª Belgium (id="BE")
  BE: 'M1016.5 177.1l-0.4 4.2-1.3 0.2-0.4 3.5-4.4-2.9-2.5 0.5-3.5-2.9-2.4-2.5-2.2-0.1-0.8-2.2 3.9-1.2 3.6 0.5 4.5-1.3 3.1 2.7 2.8 1.5z',
  
  // ğŸ‡ªğŸ‡¸ Spain (id="ES")
  ES: 'M976.6 223.4l2 2.4 9.5 2.9 1.9-1.4 5.8 2.9 5.9-0.8 0.4 3.7-4.9 4.2-6.6 1.4-0.5 2.1-3.2 3.5-2 5.2 2 3.7-3 2.8-1.2 4.2-4 1.3-3.7 4.9-6.8 0.1-5-0.1-3.4 2.2-2.1 2.4-2.6-0.5-1.9-2.2-1.4-3.6-4.9-1-0.4-2.2 2-2.4 0.8-1.7-1.8-1.9 1.6-4.2-2-3.8 2.3-0.5 0.3-3.1 0.8-0.9 0.3-5 2.4-1.7-1.3-3.2-3.1-0.2-0.9 0.8-3 0-1.2-3.1-2.2 0.9-1.9 1.6 0.5-4.5-2-2.7 7.4-4.6 6.2 1.1 6.9 0 5.4 1.1 4.3-0.4 8.3 0.3z',
  
  // ğŸ‡®ğŸ‡ª Ireland (id="IE")
  IE: 'M956.7 158.2l0.7 4.4-3.9 5.5-8.8 3.6-6.8-0.9 4.3-6.4-2.1-6.2 6.7-4.8 3.7-2.8 0.9 3.2-1.2 3.3 3-0.1 3.5 1.2z',
  
  // ğŸ‡ªğŸ‡ª Estonia (id="EE")
  EE: 'M1113.7 124.6l0.9 1-2.6 3.4 2.4 5.6-1.6 1.9-3.8-0.1-4.4-2.2-2.1-0.7-3.8 1-0.1-3.5-1.5 0.8-3.3-2.1-1-3.4 5.5-1.7 5.6-0.8 5.1 0.9 4.7-0.1z',
  
  // ğŸ‡µğŸ‡± Poland (id="PL")
  PL: 'M1079.9 154.8l5.9 0.7 8.8-0.1 2.5 0.7 1.4 1.9 0.6 2.7 1.7 2.3 0.4 2.4-2.8 1.3 1.9 2.8 0.5 2.8 3.2 5.4-0.3 1.7-2.3 0.7-3.8 5.2 1.6 2.8-1.1-0.4-5-2.4-3.5 0.9-2.4-0.6-2.8 1.3-2.7-2.2-1.9 0.9-0.3-0.4-2.6-3.1-3.7-0.3-0.7-2-3.4-0.7-0.6 1.6-2.8-1.3 0.2-1.7-3.7-0.5-2.5-2-2.4-3.9 0.2-2.2-1.5-3.3-1.9-2.1 1.2-1.7-1.4-3.1 3.1-1.8 7.1-2.8 5.8-2 4.8 1 0.6 1.5 4.6 0z',
  
  // ğŸ‡©ğŸ‡° Denmark (class="Denmark")
  DK: 'M 1046.1 147.7 1043.7 152.6 1038.5 149.1 1037.6 146.6 1044.4 144.6 1046.1 147.7 Z M 1033.3 151.5 1030.4 152.4 1026.7 151.6 1024.6 148.2 1024.2 142.1 1024.8 140.4 1026.1 138.6 1030.1 138.3 1031.7 136.6 1035.3 134.9 1035.3 138 1034.1 140 1034.8 141.6 1037.4 142.5 1036.4 144.8 1035 144.2 1031.9 148.5 1033.3 151.5 Z',
};

/**
 * MapPathsLayer Component
 */
export const MapPathsLayer: React.FC<MapPathsLayerProps> = ({
  opacity = 0.3,
  showOtherCountries = true,
}) => {
  // ========================================
  // Store êµ¬ë…
  // ========================================
  
  const { selectedCountry, hoveredCountry } = useESGMapStore((state) => state.mapState);
  const setHoveredCountry = useESGMapStore((state) => state.setHoveredCountry);
  const setSelectedCountry = useESGMapStore((state) => state.setSelectedCountry);

  // ========================================
  // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  // ========================================
  
  /**
   * êµ­ê°€ í˜¸ë²„ ì‹œ
   */
  const handleMouseEnter = useCallback((countryCode: CountryCode) => {
    setHoveredCountry(countryCode);
  }, [setHoveredCountry]);

  /**
   * êµ­ê°€ í˜¸ë²„ ì¢…ë£Œ ì‹œ
   */
  const handleMouseLeave = useCallback(() => {
    setHoveredCountry(null);
  }, [setHoveredCountry]);

  /**
   * êµ­ê°€ í´ë¦­ ì‹œ
   * í–¥í›„: ì§€ë„ê°€ í•´ë‹¹ êµ­ê°€ë¡œ Zoom-in
   */
  const handleClick = useCallback((countryCode: CountryCode) => {
    setSelectedCountry(countryCode);
    // TODO: ìš°ì¸¡ íŒ¨ë„ì— í•´ë‹¹ êµ­ê°€ì˜ ê¸°ì—… ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
  }, [setSelectedCountry]);

  // ========================================
  // ìŠ¤íƒ€ì¼ ê³„ì‚°
  // ========================================
  
  /**
   * êµ­ê°€ë³„ fill ìƒ‰ìƒ ê²°ì •
   */
  const getCountryFill = (countryCode: CountryCode): string => {
    if (selectedCountry === countryCode) {
      return COLORS.ACCENT; // ì„ íƒë¨: ê°•ì¡° ìƒ‰ìƒ
    }
    if (hoveredCountry === countryCode) {
      return COLORS.MAP_LAND_HOVER; // í˜¸ë²„: ë°ì€ ìƒ‰ìƒ
    }
    return COLORS.MAP_LAND; // ê¸°ë³¸: ì–´ë‘ìš´ ìƒ‰ìƒ
  };

  /**
   * êµ­ê°€ë³„ opacity ê³„ì‚°
   */
  const getCountryOpacity = (countryCode: CountryCode): number => {
    if (selectedCountry && selectedCountry !== countryCode) {
      return opacity * 0.5; // ë‹¤ë¥¸ êµ­ê°€ ì„ íƒ ì‹œ Dimmed
    }
    return opacity;
  };

  // ========================================
  // Render
  // ========================================
  
  return (
    <g id="map-paths-layer">
      {/* íƒ€ê²Ÿ êµ­ê°€ (Interactive) */}
      {(Object.entries(TARGET_COUNTRY_PATHS) as Array<[CountryCode, string]>).map(
        ([countryCode, pathData]) => (
          <path
            key={countryCode}
            d={pathData}
            fill={getCountryFill(countryCode)}
            opacity={getCountryOpacity(countryCode)}
            stroke={COLORS.MAP_BORDER}
            strokeWidth="0.5"
            strokeLinejoin="round"
            strokeLinecap="round"
            // ğŸ¯ Interactive ì´ë²¤íŠ¸
            onMouseEnter={() => handleMouseEnter(countryCode)}
            onMouseLeave={handleMouseLeave}
            onClick={() => handleClick(countryCode)}
            // ìŠ¤íƒ€ì¼
            className="transition-all duration-200 cursor-pointer"
            style={{
              pointerEvents: 'auto',
            }}
            // ì ‘ê·¼ì„±
            role="button"
            aria-label={`${countryCode} - Click to view companies`}
            tabIndex={0}
          />
        )
      )}

      {/* 
        TODO: ë‚˜ë¨¸ì§€ êµ­ê°€ (Non-interactive ë°°ê²½)
        showOtherCountries === trueì¼ ë•Œ world.svg ì „ì²´ ë¡œë“œ
        í˜„ì¬ëŠ” ìƒëµ (íƒ€ê²Ÿ êµ­ê°€ë§Œ í‘œì‹œ)
      */}
      {showOtherCountries && (
        <g id="other-countries" opacity={opacity * 0.2} pointerEvents="none">
          {/* 
            í–¥í›„ êµ¬í˜„:
            - world.svgì—ì„œ TARGET_COUNTRY_PATHS ì™¸ ëª¨ë“  path ì¶”ì¶œ
            - ë˜ëŠ” ê°„ë‹¨í•œ ëŒ€ë¥™ ìœ¤ê³½ì„ ë§Œ í‘œì‹œ
          */}
          <rect
            x="0"
            y="0"
            width="2000"
            height="857"
            fill="none"
            stroke={COLORS.MAP_BORDER}
            strokeWidth="0.5"
            strokeDasharray="5,5"
            opacity="0.1"
          />
        </g>
      )}
    </g>
  );
};

/**
 * Display Name (for React DevTools)
 */
MapPathsLayer.displayName = 'MapPathsLayer';

